"use strict";(self.webpackChunkalova_website=self.webpackChunkalova_website||[]).push([[3284],{3905:(e,t,a)=>{a.d(t,{Zo:()=>d,kt:()=>p});var n=a(7294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function r(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var c=n.createContext({}),s=function(e){var t=n.useContext(c),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},d=function(e){var t=s(e.components);return n.createElement(c.Provider,{value:t},e.children)},h={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,o=e.mdxType,i=e.originalType,c=e.parentName,d=r(e,["components","mdxType","originalType","parentName"]),m=s(a),p=o,u=m["".concat(c,".").concat(p)]||m[p]||h[p]||i;return a?n.createElement(u,l(l({ref:t},d),{},{components:a})):n.createElement(u,l({ref:t},d))}));function p(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=a.length,l=new Array(i);l[0]=m;var r={};for(var c in t)hasOwnProperty.call(t,c)&&(r[c]=t[c]);r.originalType=e,r.mdxType="string"==typeof e?e:o,l[1]=r;for(var s=2;s<i;s++)l[s]=a[s];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},4635:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>i,metadata:()=>r,toc:()=>s});var n=a(7462),o=(a(7294),a(3905));const i={title:"Cache Mode",sidebar_position:40},l=void 0,r={unversionedId:"get-started/response-cache",id:"get-started/response-cache",title:"Cache Mode",description:"Cached mode can better utilize server-side data multiple times, instead of sending a request to fetch data every time it is requested. alova provides three cache modes to meet different cache scenarios, namely memory mode, cache occupancy mode, and recovery mode. The cache mode can be set at different granularities such as global or request level. When set globally, all Method instances created by the same alova instance inherit the setting.",source:"@site/docs/03-get-started/03-response-cache.md",sourceDirName:"03-get-started",slug:"/get-started/response-cache",permalink:"/zh-CN/get-started/response-cache",draft:!1,editUrl:"https://github.com/alovajs/alovajs.github.io/blob/main/docs/03-get-started/03-response-cache.md",tags:[],version:"current",sidebarPosition:40,frontMatter:{title:"Cache Mode",sidebar_position:40},sidebar:"tutorialSidebar",previous:{title:"request method instance",permalink:"/zh-CN/get-started/request-method-instance"},next:{title:"Request at the right time",permalink:"/zh-CN/category/request-at-the-right-time"}},c={},s=[{value:"memory mode (default)",id:"memory-mode-default",level:2},{value:"Cache placeholder mode",id:"cache-placeholder-mode",level:2},{value:"recovery mode",id:"recovery-mode",level:2},{value:"What should I do if the data changes in recovery mode?",id:"what-should-i-do-if-the-data-changes-in-recovery-mode",level:3},{value:"Set cache mode globally",id:"set-cache-mode-globally",level:2},{value:"Expiration time type",id:"expiration-time-type",level:2},{value:"Relative Time",id:"relative-time",level:3},{value:"absolute time",id:"absolute-time",level:3},{value:"Cache key automatic maintenance",id:"cache-key-automatic-maintenance",level:2}],d={toc:s};function h(e){let{components:t,...a}=e;return(0,o.kt)("wrapper",(0,n.Z)({},d,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"Cached mode can better utilize server-side data multiple times, instead of sending a request to fetch data every time it is requested. ",(0,o.kt)("inlineCode",{parentName:"p"},"alova")," provides three cache modes to meet different cache scenarios, namely memory mode, cache occupancy mode, and recovery mode. The cache mode can be set at different granularities such as global or request level. When set globally, all ",(0,o.kt)("inlineCode",{parentName:"p"},"Method")," instances created by the same alova instance inherit the setting."),(0,o.kt)("h2",{id:"memory-mode-default"},"memory mode (default)"),(0,o.kt)("p",null,"In-memory mode places the cache in memory, which means that flushing the page cache will invalidate it, and is the most commonly used cache mode."),(0,o.kt)("p",null,"When you are writing the todo details page, you may think that users will frequently click to view the details in the todo list. If the user repeatedly views a certain detail, the request interface will not be repeated, and the data can be returned immediately, which improves the response speed. Colleagues also reduce server pressure. At this point we can set the response data cache for a todo detail ",(0,o.kt)("inlineCode",{parentName:"p"},"Method")," instance."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"alovaInstance.GET('/todo/list', {\n  // ...\n  // highlight-start\n  localCache: {\n    // Set the cache mode to memory mode\n    mode: cacheMode.MEMORY,\n\n    // in milliseconds\n    // When set to `Infinity`, it means that the data will never expire, when set to 0 or a negative number, it means no cache\n    expire: 60 * 10 * 1000\n  }\n  // highlight-end\n});\n")),(0,o.kt)("p",null,"The memory mode is the default mode, you can abbreviate it like this"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"alovaInstance.GET('/todo/list', {\n  // ...\n  // highlight-start\n  localCache: 60 * 10 * 1000\n  // highlight-end\n});\n")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"GET requests will default to 300000ms (5 minutes) memory cache time, developers can also customize the settings.")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"If you need to set the cache mode globally uniformly, see ","[Set cache mode globally]","(#Set cache mode globally) at the bottom of this section")),(0,o.kt)("h2",{id:"cache-placeholder-mode"},"Cache placeholder mode"),(0,o.kt)("p",null,"When you don't want the application to display Loading every time you enter, but want to replace Loading with old data, you can use cached placeholder mode, which has a better experience than Loading."),(0,o.kt)("p",null,"In cache occupancy mode, ",(0,o.kt)("inlineCode",{parentName:"p"},"data")," will be immediately assigned to the old data cached last time. You can judge that if there is old data, use it instead of Loading display. At the same time, it will send a request to get the latest data and update the cache, so as to achieve In order to quickly display the actual data, and obtain the latest data."),(0,o.kt)("p",null,"Set on the ",(0,o.kt)("inlineCode",{parentName:"p"},"Method")," instance:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"const todoListGetter = alovaInstance.Get('/todo/list', {\n  // ...\n  // highlight-start\n  localCache: {\n    // Set the cache mode to persistent placeholder mode\n    mode: cacheMode.STORAGE_PLACEHOLDER,\n    // cache time\n    expire: 60 * 10 * 1000\n  }\n  // highlight-end\n});\n")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"If you need to set the cache mode globally uniformly, see ","[Set cache mode globally]","(#Set cache mode globally) at the bottom of this section")),(0,o.kt)("h2",{id:"recovery-mode"},"recovery mode"),(0,o.kt)("p",null,"In this mode, the server-side cached data will persist. If the expiration time is not reached, even if the page cache is refreshed, it will not be invalidated. It is generally used for some data that needs server-side management but is basically unchanged, such as the specific dates of annual holidays. It is different, but it will not change. In this scenario, we only need to set the cache expiration time to the last moment of this year."),(0,o.kt)("p",null,"Set on the ",(0,o.kt)("inlineCode",{parentName:"p"},"Method")," instance:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"const todoListGetter = alovaInstance.Get('/todo/list', {\n  // ...\n  // highlight-start\n  localCache: {\n    // Set cache mode to persistent mode\n    mode: cacheMode.STORAGE_RESTORE,\n    // cache time\n    expire: 60 * 10 * 1000\n  }\n  // highlight-end\n});\n")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"If you need to set the cache mode globally uniformly, see ","[Set cache mode globally]","(#Set cache mode globally) at the bottom of this section")),(0,o.kt)("h3",{id:"what-should-i-do-if-the-data-changes-in-recovery-mode"},"What should I do if the data changes in recovery mode?"),(0,o.kt)("p",null,"When the ",(0,o.kt)("inlineCode",{parentName:"p"},"Method")," instance in recovery mode is set, it may be due to the change of interface data or the logic change of front-end processing response data. In this case, it is necessary to let the user re-cache the changed data after publishing the application. At this time, you can pass the ",(0,o.kt)("inlineCode",{parentName:"p"},"tag")," The attribute sets the cache tag. Each persistent data contains a ",(0,o.kt)("inlineCode",{parentName:"p"},"tag")," identifier. When the ",(0,o.kt)("inlineCode",{parentName:"p"},"tag")," changes, the original persistent data will be invalid, and the new data will be retrieved and identified with the new ",(0,o.kt)("inlineCode",{parentName:"p"},"tag"),". ."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"const todoListGetter = alovaInstance.Get('/todo/list', {\n  // ...\n  localCache: {\n    mode: cacheMode.STORAGE_RESTORE,\n    expire: 60 * 10 * 1000,\n\n    // highlight-start\n    // Add or modify the tag parameter, the cached data will be invalid\n    // It is recommended to use the form of version number management\n    tag: 'v1'\n    // highlight-end\n  }\n});\n")),(0,o.kt)("h2",{id:"set-cache-mode-globally"},"Set cache mode globally"),(0,o.kt)("admonition",{title:"tips",type:"info"},(0,o.kt)("p",{parentName:"admonition"},"v1.3.0+")),(0,o.kt)("p",null,"The above settings are all set the cache mode separately on ",(0,o.kt)("inlineCode",{parentName:"p"},"Method"),". If you need to set the cache mode globally, you can do it as follows:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"const alovaInstance = createAlova({\n  // ...\n  // highlight-start\n  localCache: {\n    // uniformly set the cache mode of POST\n    POST: {\n      mode: cacheMode.STORAGE_PLACEHOLDER,\n      expire: 60 * 10 * 1000\n    },\n    // Uniformly set the cache mode for HEAD requests\n    HEAD: 60 * 10 * 1000\n  }\n  // highlight-end\n});\n")),(0,o.kt)("p",null,"Thereafter, ",(0,o.kt)("inlineCode",{parentName:"p"},"Method")," instances created by ",(0,o.kt)("inlineCode",{parentName:"p"},"alovaInstance")," instances will use this cache setting by default, and it can also be overridden in ",(0,o.kt)("inlineCode",{parentName:"p"},"Method")," instances."),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"Note: When the cache mode is set globally, the original 5-minute GET cache mode will be overwritten.")),(0,o.kt)("h2",{id:"expiration-time-type"},"Expiration time type"),(0,o.kt)("p",null,"There are two types of expiration time to choose from, ",(0,o.kt)("strong",{parentName:"p"},"relative time")," and ",(0,o.kt)("strong",{parentName:"p"},"absolute time")),(0,o.kt)("h3",{id:"relative-time"},"Relative Time"),(0,o.kt)("p",null,"That is, it starts when the cached data is saved, and the expiration time is in ",(0,o.kt)("strong",{parentName:"p"},"milliseconds"),". The above examples are all of this type."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"localCache: 60 * 10 * 1000;\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"localCache: {\nexpire: 60 * 10 * 1000,\n}\n")),(0,o.kt)("h3",{id:"absolute-time"},"absolute time"),(0,o.kt)("p",null,"Taking a specific time point as the expiration time, the cache will expire at the set time point"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"localCache: new Date('2030-01-01');\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"localCache: {\n  expire: new Date('2030-01-01');\n}\n")),(0,o.kt)("h2",{id:"cache-key-automatic-maintenance"},"Cache key automatic maintenance"),(0,o.kt)("p",null,"The key of the response data cache is uniquely identified by the combination of the method instance's request method (method), request address (url), request header parameters (headers), url parameters (params), and request body parameters (requestBody), and any location is different. will be treated as different keys."))}h.isMDXComponent=!0}}]);