---
title: 设置缓存策略
order: 30
---

当你在写 todo 详情页的时候，你可能会想到用户会频繁在 todo 列表中点击查看详情，如果用户重复查看某条详情时不再重复请求接口，并且能立即返回数据，那该多好，既提升了响应速度，又减小了服务器压力。此时我们就可以为某个 todo 详情`Method`对象设置响应数据缓存。默认只有`alova.Get`会带有 300000ms(5 分钟)的响应数据缓存时间，开发者也可以自定义设置。

> ⚠️ 响应数据缓存的 key：是由 method 实例的请求方法(method)、请求地址(url)、请求头参数(headers)、url 参数(params)、请求体参数(requestBody)组合作为唯一标识，任意一个位置不同都将被当做不同的 key。

以下是全局设置响应缓存时间的方法，所有由`alova`创建的`Method`对象都会继承该设置。`alova`的缓存有三种模式，分别为内存模式、持久化模式、持久化占位模式。

## 内存模式（默认）

表示缓存放在内存中，这意味着刷新页面缓存即失效，是最常用的缓存模式。

```javascript
const alovaInstance = createAlova({
	// 省略其他参数...

	localCache: {
		// 设置缓存模式为内存模式
		mode: cacheMode.MEMORY,

		// 单位为毫秒
		// 当设置为`Infinity`，表示数据永不过期，设置为0或负数时表示不缓存
		expire: 60 * 10 * 1000
	},

	////////////////////////
	////////////////////////
	// 因为默认是内存模式，上面的设置也可以简写成这样
	localCache: 60 * 10 * 1000
});
```

## 持久化模式

表示缓存放在诸如`localStorage`存储中，如果过期时间未到即使刷新页面缓存也不会失效，它一般用于一些需要服务端管理，但基本不变的数据。

```javascript
const alovaInstance = createAlova({
	// 省略其他参数...

	localCache: {
		// 设置缓存模式为持久化模式
		mode: cacheMode.STORAGE_RESTORE,

		// 单位为毫秒
		// 当设置为`Infinity`，表示数据永不过期，设置为0或负数时表示不缓存
		expire: 60 * 10 * 1000,

		// 缓存标签
		tag: 'v1'
	}
});
```

> ⚠️ 缓存标签 tag 参数：出于对接口数据变动、前端处理响应数据逻辑变动原因，你需要在发布后让原持久化缓存立即失效，此时你可以设置`tag`属性，每一份持久化数据都包含一个`tag`标识，当`tag`改变后原有的持久化数据就会失效，并重新获取新的数据，并用新的`tag`进行标识。

## 持久化占位模式

当页面数据在加载时不希望只展示加载图标，而是实际数据，同时又去加载最新数据时，我们可以使用持久化占位模式，首次加载它也会持久化缓存数据，然后再次请求时立即返回缓存数据，但和持久化模式不同的是，它还会立即发出请求并更新缓存，这样就达到了既快速展示实际数据，又获取了最新的数据。

```javascript
const alovaInstance = createAlova({
	// 省略其他参数...

	localCache: {
		// 设置缓存模式为持久化占位模式
		mode: cacheMode.STORAGE_PLACEHOLDER,
		// 缓存时间
		expire: 60 * 10 * 1000,

		// 此模式同样支持缓存标签
		tag: 'v1'
	}
});
```

以上缓存设置同样支持请求级别，在创建请求方法对象上设置`localCache`参数来达到目的，设置方法相同。

```javascript
const todoListGetter = alova.Get('/todo/list', {
	// 省略其他参数...

	// 参数用法与全局相同
	localCache: 60 * 10 * 1000
});
```