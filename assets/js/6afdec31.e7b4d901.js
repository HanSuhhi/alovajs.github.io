"use strict";(self.webpackChunkalova_website=self.webpackChunkalova_website||[]).push([[8614],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),d=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},p=function(e){var t=d(e.components);return a.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),c=d(n),m=r,h=c["".concat(l,".").concat(m)]||c[m]||u[m]||o;return n?a.createElement(h,s(s({ref:t},p),{},{components:n})):a.createElement(h,s({ref:t},p))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,s=new Array(o);s[0]=c;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:r,s[1]=i;for(var d=2;d<o;d++)s[d]=n[d];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},6487:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>u,frontMatter:()=>o,metadata:()=>i,toc:()=>d});var a=n(7462),r=(n(7294),n(3905));const o={title:"Delay data update",sidebar_position:80},s=void 0,i={unversionedId:"next-step/delayed-data-update",id:"next-step/delayed-data-update",title:"Delay data update",description:"You may have the following requirements:  When creating a todo item, set it to silent submission, and immediately call updateState to update the todo list, so that although the newly added todo item can be seen on the interface immediately, but there is no id, Therefore this todo item cannot be edited or deleted without re-requesting the full data.",source:"@site/docs/06-next-step/08-delayed-data-update.md",sourceDirName:"06-next-step",slug:"/next-step/delayed-data-update",permalink:"/next-step/delayed-data-update",draft:!1,editUrl:"https://github.com/alovajs/alovajs.github.io/blob/main/docs/06-next-step/08-delayed-data-update.md",tags:[],version:"current",sidebarPosition:80,frontMatter:{title:"Delay data update",sidebar_position:80},sidebar:"tutorialSidebar",previous:{title:"Silent/Offline submit",permalink:"/next-step/silent-offline-submit"},next:{title:"Advanced",permalink:"/category/advanced"}},l={},d=[{value:"A simple example",id:"a-simple-example",level:2},{value:"Delayed update placeholder format syntax",id:"delayed-update-placeholder-format-syntax",level:2},{value:"Short form",id:"short-form",level:3},{value:"Array format",id:"array-format",level:3},{value:"use in arrays",id:"use-in-arrays",level:2},{value:"use in objects",id:"use-in-objects",level:2},{value:"on non-arrays and objects",id:"on-non-arrays-and-objects",level:2},{value:"used in combination of arrays and objects",id:"used-in-combination-of-arrays-and-objects",level:2}],p={toc:d};function u(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"You may have the following requirements: ",(0,r.kt)("strong",{parentName:"p"}," When creating a todo item, set it to silent submission, and immediately call ",(0,r.kt)("inlineCode",{parentName:"strong"},"updateState")," to update the todo list, so that although the newly added todo item can be seen on the interface immediately, but there is no id, Therefore this todo item cannot be edited or deleted without re-requesting the full data. ")),(0,r.kt)("p",null,"Deferred data update is used to solve this problem, it allows you to mark the id field with a placeholder format, replace the placeholder with a ",(0,r.kt)("inlineCode",{parentName:"p"},"default")," value or ",(0,r.kt)("inlineCode",{parentName:"p"},"undefined")," before the response, and then automatically put it after the response. The actual data replaces placeholder markers."),(0,r.kt)("h2",{id:"a-simple-example"},"A simple example"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"const newTodo = {\n  title: '...',\n  time: '10:00'\n};\nconst { onSuccess } = useRequest(/*...*/); // silently submit\nonSuccess(() => {\n  updateState(/*...*/, todoList => {\n    // The key in the delayed update expression starts with `+` and the value is set to the getter function\n    // It will be called after the response and replace the return value on the id property, the res parameter is the response data\n    const newTodoWithPlaceholder = {\n      '+id': res => res.id,\n    };\n\n    return [\n      ...todoList,\n      newTodoWithPlaceholder,\n    ];\n  });\n});\n")),(0,r.kt)("p",null,"The above ",(0,r.kt)("inlineCode",{parentName:"p"},"newTodoWithPlaceholder")," data will be compiled into the following value before responding, and the todo list page can immediately display the new todo item."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"{\n  id: undefined,\n  title: '...',\n  time: '10:00',\n};\n")),(0,r.kt)("p",null,"After the response, the id will be replaced by the return value of the getter function. At this time, the new todo item also supports operations such as editing and deleting."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"// Assume the response data is { id: 10 }\n{\n  id: 10,\n  title: '...',\n  time: '10:00',\n};\n")),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"For a more complete practical example, please move to ",(0,r.kt)("a",{parentName:"p",href:"../example/safer-ptimistic-update"},"example-safer optimistic update"))),(0,r.kt)("h2",{id:"delayed-update-placeholder-format-syntax"},"Delayed update placeholder format syntax"),(0,r.kt)("p",null,"In fact, in the above example code, the key starting with ",(0,r.kt)("strong",{parentName:"p"},"+")," is a shorthand format, which only applies to objects. In fact, it has 3 syntax formats, provides richer functions, and allows us to use it in an array or even a single value, let's take a look."),(0,r.kt)("h3",{id:"short-form"},"Short form"),(0,r.kt)("p",null,"The key starts with a ",(0,r.kt)("strong",{parentName:"p"},"+")," sign and is only suitable for use in objects."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"{\n  '+id': res => res.id\n}\n")),(0,r.kt)("h3",{id:"array-format"},"Array format"),(0,r.kt)("p",null,"Specify a default value while setting the getter function. The default value will be used as a temporary value before the data response. The key starts with ",(0,r.kt)("strong",{parentName:"p"},"+")," and is only suitable for use in objects."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"{\n  '+id': [res => res.id, 0]\n}\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Full format:"),"\nRepresents the placeholder format as an object, which can be used anywhere"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"{\n  // The value of action is a fixed spelling\n  action: 'responsed',\n\n  // getter function for delayed update\n  // It will be called after the response and replace the return value on the id property, the res parameter is the response data\n  value: res => res.id,\n\n  // Default value before data update, optional, undefined if not set\n  default: 0,\n}\n")),(0,r.kt)("p",null,"Next, let's take a look at how the placeholder format for delayed update is used in different data structures."),(0,r.kt)("h2",{id:"use-in-arrays"},"use in arrays"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"[1, 2, { action: 'responsed', value: res => res.id }][\n  // data before response\n  (1, 2, undefined)\n][\n  // => response data\n  // Assume the response data is { id: 10 }\n  (1, 2, 10)\n];\n")),(0,r.kt)("h2",{id:"use-in-objects"},"use in objects"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"{\n  a: { action: 'responsed', value: res => res.id },\n  b: { action: 'responsed', value: res => res.id, default: 1 },\n}\n// When placeholders are set to object properties, they can be abbreviated as follows\n// key starts with \"+\"\n{\n  '+a': res => res.id, // only set the getter function\n  '+b': [res => res.id, 1], // set the getter function and default value\n}\n\n// data before response\n{\n  a: undefined,\n  b: 1,\n}\n\n// => response data\n// Assume the response data is { id: 10 }\n{\n  a: 10,\n  b: 10,\n}\n")),(0,r.kt)("h2",{id:"on-non-arrays-and-objects"},"on non-arrays and objects"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"// directly represented as a placeholder\n{\n  action: 'responsed',\n  value: res => res.data,\n  default: { name: '', age: 0 }\n}\n\n// data before response\n{ name: '', age: 0 }\n\n// => response data\n// Assume the response data is { data: { name: 'Tom', age: 18 } }\n{ name: 'Tom', age: 18 }\n")),(0,r.kt)("h2",{id:"used-in-combination-of-arrays-and-objects"},"used in combination of arrays and objects"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"[\n  1,\n  {action: 'responsed', value: res => res.id, default: 12},\n  res => res.id,\n  4,\n  {\n    a: 1,\n    b: 2,\n    '+c': res => res.id,\n    d: {action: 'responsed', value: res => res.id, default: 24},\n    e: [\n      {action: 'responsed', value: res => res.id, default: 36},\n      3,\n      6\n    ]\n  }\n]\n\n// data before response\n[\n  1,\n  12,\n  res => res.id, // shorthand can only be used in objects with + prefixed key, so does not compile\n  4,\n  {\n    a: 1,\n    b: 2,\n    c: undefined,\n    d: 24,\n    e: [\n      36,\n      3,\n      6\n    ]\n  }\n]\n\n// => response data\n// Assume the response data is { id: 10 }\n[\n  1,\n  10,\n  res => res.id, // shorthand can only be used in objects with + prefixed key, so does not compile\n  4,\n  {\n    a: 1,\n    b: 2,\n    c: 10\n    d: 10,\n    e: [\n      10,\n      3,\n      6\n    ]\n  }\n]\n")),(0,r.kt)("admonition",{title:"limit 1",type:"danger"},(0,r.kt)("p",{parentName:"admonition"},"Delayed data update is only valid in silent mode, and the ",(0,r.kt)("inlineCode",{parentName:"p"},"updateState")," function is called synchronously in the ",(0,r.kt)("inlineCode",{parentName:"p"},"onSuccess")," callback function, otherwise it may cause data confusion or error.")),(0,r.kt)("admonition",{title:"limit 2",type:"danger"},(0,r.kt)("p",{parentName:"admonition"},"If there is a circular reference in the updated value of ",(0,r.kt)("inlineCode",{parentName:"p"},"updateState"),", the delayed data update will not take effect")))}u.isMDXComponent=!0}}]);