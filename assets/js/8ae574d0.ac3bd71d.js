"use strict";(self.webpackChunkalova_website=self.webpackChunkalova_website||[]).push([[3873],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>m});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),d=c(n),m=o,h=d["".concat(l,".").concat(m)]||d[m]||p[m]||r;return n?a.createElement(h,i(i({ref:t},u),{},{components:n})):a.createElement(h,i({ref:t},u))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:o,i[1]=s;for(var c=2;c<r;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},5873:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>p,frontMatter:()=>r,metadata:()=>s,toc:()=>c});var a=n(7462),o=(n(7294),n(3905));const r={title:"Custom States Hook",sidebar_position:20},i=void 0,s={unversionedId:"advanced/custom-stateshook",id:"advanced/custom-stateshook",title:"Custom States Hook",description:"Remember the statesHook you passed in when calling createAlova? It will decide which MVVM library status you return when you request, such as VueHook in vue project, ReactHook in react project, SvelteHook in svelte project, currently only these three libraries are supported. In most cases you should not use this feature, but if you need to adapt to more MVVM libraries that we don't support yet, you need to custom write statesHook.",source:"@site/docs/07-advanced/02-custom-stateshook.md",sourceDirName:"07-advanced",slug:"/advanced/custom-stateshook",permalink:"/advanced/custom-stateshook",draft:!1,editUrl:"https://github.com/alovajs/alovajs.github.io/blob/main/docs/07-advanced/02-custom-stateshook.md",tags:[],version:"current",sidebarPosition:20,frontMatter:{title:"Custom States Hook",sidebar_position:20},sidebar:"tutorialSidebar",previous:{title:"Custom Request Adapter",permalink:"/advanced/custom-http-adapter"},next:{title:"Custom Storage Adapter",permalink:"/advanced/custom-storage-adapter"}},l={},c=[{value:"statesHook structure",id:"stateshook-structure",level:2},{value:"Custom statesHook function description",id:"custom-stateshook-function-description",level:2}],u={toc:c};function p(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"Remember the ",(0,o.kt)("inlineCode",{parentName:"p"},"statesHook")," you passed in when calling ",(0,o.kt)("inlineCode",{parentName:"p"},"createAlova"),"? It will decide which MVVM library status you return when you request, such as ",(0,o.kt)("inlineCode",{parentName:"p"},"VueHook")," in vue project, ",(0,o.kt)("inlineCode",{parentName:"p"},"ReactHook")," in react project, ",(0,o.kt)("inlineCode",{parentName:"p"},"SvelteHook")," in svelte project, currently only these three libraries are supported. In most cases you should not use this feature, but if you need to adapt to more MVVM libraries that we don't support yet, you need to custom write ",(0,o.kt)("inlineCode",{parentName:"p"},"statesHook"),"."),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"statesHook")," is an ordinary object containing certain functions, but these are still basically no algorithms, let's see how ",(0,o.kt)("strong",{parentName:"p"},"VueHook")," is written."),(0,o.kt)("h2",{id:"stateshook-structure"},"statesHook structure"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"import { ref, watch, onUnmounted } from 'vue';\n\nconst VueHook = {\n  // state creation function\n  create: rawData => ref(data),\n\n  // state export function\n  export: state => state,\n\n  // dehydration function\n  dehydrate: state => state.value,\n\n  // responsive state update function\n  update: (newVal, states) => {\n    Object.keys(newVal).forEach(key => {\n      states[key].value = newVal[key];\n    });\n  },\n\n  // request to send control function\n  effectRequest({ handler, removeStates, saveStates, immediate, frontStates, watchingStates }) {\n    // Remove the corresponding state when the component is unloaded\n    onUnmounted(removeStates);\n\n    // When calling useRequest and useFetcher, watchingStates is undefined\n    if (!watchingStates) {\n      handler();\n      return;\n    }\n\n    // When calling useWatcher, watchingStates is an array of states that need to be monitored\n    // When immediate is true, it means that the request needs to be sent immediately\n    watch(watchingStates, handler, { immediate });\n  }\n};\n")),(0,o.kt)("h2",{id:"custom-stateshook-function-description"},"Custom statesHook function description"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"The following 5 functions must be specified.")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"create"),": Responsive state creation function, ",(0,o.kt)("inlineCode",{parentName:"li"},"loading"),", ",(0,o.kt)("inlineCode",{parentName:"li"},"error"),", ",(0,o.kt)("inlineCode",{parentName:"li"},"data"),", ",(0,o.kt)("inlineCode",{parentName:"li"},"downloading"),", ",(0,o.kt)("inlineCode",{parentName:"li"},"uploading"),", etc. are all created by calling this function, for example, it will be created as a ref value under the vue3 project ;"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"export"),": state export function, this function receives the responsive state created by the create function, and exports the state that is finally used by developers, where the state exported by ",(0,o.kt)("inlineCode",{parentName:"li"},"VueHook")," is the original state;"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"dehydrate"),": Dehydration function, which means to convert the responsive state into normal data, which is the opposite of create, in ",(0,o.kt)("inlineCode",{parentName:"li"},"updateState"),";"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"update"),": Responsive state update function, the state update maintained by ",(0,o.kt)("inlineCode",{parentName:"li"},"alova")," is completed through this function. This function receives two parameters, the first parameter is the new data object, the second parameter is the map collection of the original reactive state, here you can write a fixed loop to update ",(0,o.kt)("inlineCode",{parentName:"li"},"states"),";"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"effectRequest"),": request sending control function, it will execute this function immediately when ",(0,o.kt)("inlineCode",{parentName:"li"},"useRequest"),", ",(0,o.kt)("inlineCode",{parentName:"li"},"useWatcher"),", ",(0,o.kt)("inlineCode",{parentName:"li"},"useFetcher")," are called, we need to do three things in this function:",(0,o.kt)("ol",{parentName:"li"},(0,o.kt)("li",{parentName:"ol"},"When the current component is uninstalled, call the removeStates function to remove the responsive state involved in the current component to avoid memory overflow;"),(0,o.kt)("li",{parentName:"ol"},"When calling useWatcher, bind the state monitor, and call the sendRequest function when the state changes. You can use whether ",(0,o.kt)("inlineCode",{parentName:"li"},"states")," is an array to judge whether ",(0,o.kt)("inlineCode",{parentName:"li"},"useWatcher")," is called, and at the same time, the ",(0,o.kt)("inlineCode",{parentName:"li"},"immediate")," parameter is used to judge the ",(0,o.kt)("inlineCode",{parentName:"li"},"useWatcher")," call whether the request needs to be sent immediately;"),(0,o.kt)("li",{parentName:"ol"},"When calling ",(0,o.kt)("inlineCode",{parentName:"li"},"useRequest")," and ",(0,o.kt)("inlineCode",{parentName:"li"},"useFetcher"),", call sendRequest to send a request, at this time ",(0,o.kt)("inlineCode",{parentName:"li"},"states")," is ",(0,o.kt)("inlineCode",{parentName:"li"},"undefined"),";")))),(0,o.kt)("admonition",{title:"note",type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"If the library involved in statesHook is like ",(0,o.kt)("inlineCode",{parentName:"p"},"react"),", the use hook of ",(0,o.kt)("inlineCode",{parentName:"p"},"alova")," will be called each time it is re-rendered, then in ",(0,o.kt)("inlineCode",{parentName:"p"},"effectRequest")," it is also necessary to trigger the ",(0,o.kt)("inlineCode",{parentName:"p"},"saveStates")," function every time it re-renders, this is because ",(0,o.kt)("inlineCode",{parentName:"p"},"react")," `Every re-render refreshes its state references, so we need to re-save them again.")),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/alovajs/alova/blob/main/src/predefine/ReactHook.ts"},"Click here to view the ReactHook source code")),(0,o.kt)("p",null,"If you want to support typescript when you customize statesHook, you can ","[click here]","(./typescript#request adapter type)"))}p.isMDXComponent=!0}}]);